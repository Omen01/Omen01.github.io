<!DOCTYPE html>
<html>
<head>
    <title>Anime Wordle</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            background: #2c2f33; 
            display: flex; 
            justify-content: center; 
            padding-left: 410px; /* Desktop padding */
        }
        .container { 
            display: flex; 
            flex-direction: row; 
            align-items: flex-start; 
            width: 100%; 
            max-width: 1000px; 
            margin: 0 auto; 
        }
        .game-area { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            width: 60%; 
            max-width: 600px; 
            min-height: 100%; /* Ensure content displays on mobile */
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(5, 50px); /* Fixed size for desktop */
            gap: 5px; 
            margin: 20px 0; 
        }
        .tile { 
            width: 50px; 
            height: 50px; 
            border: 2px solid #ccc; 
            text-align: center; 
            line-height: 50px; 
            font-size: 20px; 
        }
        .green { background: #6aaa64; color: white; border-color: #6aaa64; }
        .yellow { background: #c9b458; color: white; border-color: #c9b458; }
        .gray { background: #787c7e; color: white; border-color: #787c7e; }
        #guessInput { margin: 10px; padding: 5px; font-size: 16px; }
        button { padding: 5px 10px; font-size: 16px; margin: 5px; }
        #message { color: white; margin: 20px 0; font-size: 24px; font-weight: bold; text-align: center; }
        .keyboard { margin-top: 20px; }
        .keyboard-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .key { width: 30px; height: 40px; border: 1px solid #ccc; text-align: center; line-height: 40px; background: #fff; cursor: pointer; font-size: 16px; }
        .key.green { background: #6aaa64; color: white; }
        .key.yellow { background: #c9b458; color: white; }
        .key.gray { background: #787c7e; color: white; }
        #score { color: white; margin: 10px; font-size: 16px; font-weight: bold; }
        .progress-area { display: flex; flex-direction: column; align-items: center; margin-left: 2%; }
        .progress-grid { display: grid; grid-template-columns: repeat(5, 50px); gap: 5px; }
        .progress-tile { width: 50px; height: 50px; border: 2px solid #ccc; text-align: center; line-height: 50px; font-size: 20px; background: #444; color: white; }
        #hintButton:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Media query for mobile devices (e.g., max-width: 768px) */
        @media (max-width: 768px) {
            body { padding-left: 0; } /* Remove padding on mobile */
            .container { 
                flex-direction: column; 
                align-items: center; 
                width: 100%; 
                max-width: none; 
            }
            .game-area { width: 100%; max-width: none; margin: 0; flex-grow: 1; }
            .grid { grid-template-columns: repeat(5, 24vw); margin: 10px 0; }
            .tile { width: 24vw; height: 24vw; line-height: 24vw; font-size: 9vw; }
            #guessInput { font-size: 9vw; }
            button { font-size: 8vw; padding: 15px 30px; }
            #message { font-size: 9vw; }
            .keyboard { margin-top: 10px; }
            .key { width: 18vw; height: 21vw; line-height: 21vw; font-size: 8vw; }
            #score { font-size: 8vw; }
            .progress-area { 
                width: 100%; 
                margin-top: auto; 
                text-align: center; 
            }
            .progress-grid { grid-template-columns: repeat(5, 24vw); }
            .progress-tile { width: 24vw; height: 24vw; line-height: 24vw; font-size: 9vw; }
            #hintButton { font-size: 8vw; padding: 15px 30px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-area">
            <h1>Anime Wordle</h1>
            <div id="score">Score: 0</div>
            <div class="grid" id="gameGrid"></div>
            <input type="text" id="guessInput" maxlength="5" placeholder="Enter 5-letter word" autofocus>
            <button id="guessButton">Guess</button>
            <button id="playAgainButton" style="display: none">Play Again</button>
            <p id="message"></p>
            <div class="keyboard" id="keyboard"></div>
        </div>
        <div class="progress-area">
            <h2>Progress</h2>
            <div class="progress-grid" id="progressGrid"></div>
            <button id="hintButton">Hint</button>
        </div>
    </div>

    <script>
        let words = [];
        let secret = '';
        let grid = null;
        let progressGrid = null;
        let attempts = 0;
        let maxAttempts = 6;
        let message = null;
        let keyboard = {};
        let score = 0; // Track consecutive wins
        let gameEnded = false; // Flag to track game end state
        let progress = ['', '', '', '', '']; // Track progress for each position
        let hintsUsed = 0; // Track number of hints used

        // Fetch words.txt and initialize game
        fetch('words.txt')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.text();
            })
            .then(text => {
                words = text.trim().split('\n').map(word => word.trim().toUpperCase()).filter(word => word.length === 5);
                if (words.length === 0) {
                    console.error('No valid 5-letter words found in words.txt');
                    message = document.getElementById('message');
                    message.textContent = 'Error: No valid words available.';
                    return;
                }
                secret = words[Math.floor(Math.random() * words.length)];
                grid = document.getElementById('gameGrid');
                progressGrid = document.getElementById('progressGrid');
                message = document.getElementById('message');
                document.getElementById('score').textContent = `Score: ${score}`; // Initialize score display
                createGrid();
                createProgressGrid();
                createKeyboard();
                // Add event listeners
                document.getElementById('guessInput').addEventListener('keyup', (event) => {
                    if (event.key === 'Enter' && attempts < maxAttempts && !gameEnded) makeGuess(); // Enter for guessing
                });
                document.getElementById('guessButton').addEventListener('click', makeGuess);
                document.getElementById('playAgainButton').addEventListener('click', playAgain);
                document.getElementById('hintButton').addEventListener('click', getHint);
                // Add Shift+Enter for Play Again after game end
                document.addEventListener('keydown', (event) => {
                    const playAgainButton = document.getElementById('playAgainButton');
                    if (event.key === 'Enter' && event.shiftKey && playAgainButton.style.display === 'block' && !document.getElementById('guessInput').value) {
                        playAgain();
                        event.preventDefault(); // Prevent default Enter behavior
                    }
                });
            })
            .catch(error => {
                console.error('Error loading words.txt:', error);
                message = document.getElementById('message');
                message.textContent = 'Error loading word list. Please try again later.';
            });

        function createGrid() {
            if (!grid) {
                console.error('Grid element not found');
                return;
            }
            grid.innerHTML = ''; // Clear previous grid
            for (let i = 0; i < maxAttempts * 5; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                grid.appendChild(tile);
            }
        }

        function createProgressGrid() {
            if (!progressGrid) {
                console.error('Progress grid element not found');
                return;
            }
            progressGrid.innerHTML = ''; // Clear previous progress grid
            for (let i = 0; i < 5; i++) {
                const tile = document.createElement('div');
                tile.className = 'progress-tile';
                tile.textContent = progress[i] || '';
                progressGrid.appendChild(tile);
            }
        }

        function createKeyboard() {
            const keyboardLayout = [
                ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
            ];
            const keyboardDiv = document.getElementById('keyboard');
            keyboardLayout.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                row.forEach(key => {
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    keyDiv.textContent = key;
                    keyboard[key] = { element: keyDiv, state: 'unset' }; // Track state
                    rowDiv.appendChild(keyDiv);
                });
                keyboardDiv.appendChild(rowDiv);
            });
        }

        function updateKeyboard(guess, feedback) {
            guess.split('').forEach((letter, i) => {
                const state = feedback[i].includes('🟩') ? 'green' : feedback[i].includes('🟨') ? 'yellow' : 'gray';
                if (keyboard[letter.toUpperCase()].state === 'unset' || (state === 'green' && keyboard[letter.toUpperCase()].state !== 'green')) {
                    keyboard[letter.toUpperCase()].element.className = `key ${state}`;
                    keyboard[letter.toUpperCase()].state = state;
                }
            });
        }

        function makeGuess() {
            if (words.length === 0 || !secret) {
                message.textContent = 'Game not initialized. Please refresh.';
                return;
            }
            const input = document.getElementById('guessInput').value.toUpperCase();
            if (input.length !== 5 || !words.includes(input)) {
                message.textContent = 'Guess an actual word next time...';
                return;
            }
            const tiles = grid.children;
            const start = attempts * 5;
            const feedback = [];
            const secretList = secret.split('');
            let greenCount = 0;
            for (let i = 0; i < 5; i++) {
                const tile = tiles[start + i];
                if (input[i] === secretList[i]) {
                    feedback.push(`🟩 ${input[i]}`);
                    tile.className = 'tile green';
                    secretList[i] = null;
                    progress[i] = input[i]; // Update progress for all green matches
                    greenCount++; // Increment green count for each match
                } else if (secretList.includes(input[i])) {
                    feedback.push(`🟨 ${input[i]}`);
                    tile.className = 'tile yellow';
                    secretList[secretList.indexOf(input[i])] = null;
                } else {
                    feedback.push(`⬛ ${input[i]}`);
                    tile.className = 'tile gray';
                }
                tile.textContent = input[i];
            }
            console.log(`Attempt ${attempts}, Green Count: ${greenCount}, Feedback: ${feedback.join(', ')}, Progress: ${progress.join(', ')}`);
            updateKeyboard(input, feedback);
            updateProgressGrid();
            attempts++;
            updateHintButton(greenCount);
            if (input === secret) {
                message.textContent = `Actual Dweeb! You got the answer ${secret}. Attempts: ${attempts}`;
                score++; // Increment score on win
                document.getElementById('score').textContent = `Score: ${score}`;
                gameEnded = true; // Set game end flag
                document.getElementById('playAgainButton').style.display = 'block';
            } else if (attempts === maxAttempts) {
                message.textContent = `LOL! Try again next time! Word was ${secret}`;
                score = 0; // Reset score on loss
                document.getElementById('score').textContent = `Score: ${score}`;
                gameEnded = true; // Set game end flag
                document.getElementById('playAgainButton').style.display = 'block';
            }
            document.getElementById('guessInput').value = '';
        }

        function updateProgressGrid() {
            const tiles = progressGrid.children;
            for (let i = 0; i < 5; i++) {
                tiles[i].textContent = progress[i] || '';
            }
        }

        function getHint() {
            if (gameEnded || !secret || hintsUsed >= 2) return; // Limit to 2 hints
            const emptyIndices = progress.map((p, i) => !p && i).filter(i => i !== false);
            if (emptyIndices.length > 0) {
                const index = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
                progress[index] = secret[index];
                updateProgressGrid();
                hintsUsed++;
                updateHintButton(); // Update button state after using hint
            }
        }

        function updateHintButton(greenCount) {
            const hintButton = document.getElementById('hintButton');
            console.log(`Attempts: ${attempts}, Green Count: ${greenCount}, Hints Used: ${hintsUsed}, Game Ended: ${gameEnded}, Secret: ${secret}`);
            if (!gameEnded && hintsUsed < 2) {
                hintButton.disabled = false; // Enable hint permanently unless max hints or game ended
            } else {
                hintButton.disabled = true; // Disable after 2 hints or game end
            }
        }

        function playAgain() {
            attempts = 0;
            gameEnded = false; // Reset game end flag
            secret = words[Math.floor(Math.random() * words.length)];
            message.textContent = 'New game started! Good Luck, Degen.';
            document.getElementById('playAgainButton').style.display = 'none';
            progress = ['', '', '', '', '']; // Reset progress
            hintsUsed = 0; // Reset hints
            createGrid();
            updateProgressGrid(); // Reset progress grid
            // Reset keyboard states
            for (let key in keyboard) {
                keyboard[key].state = 'unset';
                keyboard[key].element.className = 'key';
            }
            document.getElementById('hintButton').disabled = false; // Enable hint at start
        }
    </script>
</body>
</html>
