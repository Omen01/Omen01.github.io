<!DOCTYPE html>
<html>
<head>
    <title>Anime Wordle</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; height: 100vh; overflow: hidden; background: #2c2f33; display: flex; flex-direction: column; align-items: center; }
        .container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        .grid { display: grid; grid-template-columns: repeat(5, 50px); gap: 5px; margin: 20px 0; }
        .tile { width: 50px; height: 50px; border: 2px solid #ccc; text-align: center; line-height: 50px; font-size: 20px; }
        .green { background: #6aaa64; color: white; border-color: #6aaa64; }
        .yellow { background: #c9b458; color: white; border-color: #c9b458; }
        .gray { background: #787c7e; color: white; border-color: #787c7e; }
        #guessInput { margin: 10px; padding: 5px; font-size: 16px; }
        button { padding: 5px 10px; font-size: 16px; margin: 5px; }
        #message { color: white; margin: 20px 0; font-size: 24px; font-weight: bold; text-align: center; }
        .keyboard { margin-top: 20px; }
        .keyboard-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .key { width: 30px; height: 40px; border: 1px solid #ccc; text-align: center; line-height: 40px; background: #fff; cursor: pointer; }
        .key.green { background: #6aaa64; color: white; }
        .key.yellow { background: #c9b458; color: white; }
        .key.gray { background: #787c7e; color: white; }
        #score { color: white; margin: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Anime Wordle</h1>
        <div id="score">Score: 0</div>
        <div class="grid" id="gameGrid"></div>
        <input type="text" id="guessInput" maxlength="5" placeholder="Enter 5-letter word" autofocus>
        <button id="guessButton">Guess</button>
        <button id="playAgainButton" style="display: none;">Play Again</button>
        <p id="message"></p>
        <div class="keyboard" id="keyboard"></div>
    </div>

    <script>
        let words = [];
        let secret = '';
        let grid = null;
        let attempts = 0;
        let maxAttempts = 6;
        let message = null;
        let keyboard = {};
        let score = 0; // Track consecutive wins

        // Fetch words.txt and initialize game
        fetch('words.txt')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.text();
            })
            .then(text => {
                words = text.trim().split('\n').map(word => word.trim().toUpperCase()).filter(word => word.length === 5);
                if (words.length === 0) {
                    console.error('No valid 5-letter words found in words.txt');
                    message = document.getElementById('message');
                    message.textContent = 'Error: No valid words available.';
                    return;
                }
                secret = words[Math.floor(Math.random() * words.length)];
                grid = document.getElementById('gameGrid');
                message = document.getElementById('message');
                document.getElementById('score').textContent = `Score: ${score}`; // Initialize score display
                createGrid();
                createKeyboard();
                // Add event listeners
                document.getElementById('guessInput').addEventListener('keyup', (event) => {
                    if (event.key === 'Enter' && attempts < maxAttempts) makeGuess(); // Enter for guessing
                });
                document.getElementById('guessButton').addEventListener('click', makeGuess);
                document.getElementById('playAgainButton').addEventListener('click', playAgain);
                // Add Enter key listener for Play Again only after game end
                document.addEventListener('keyup', (event) => {
                    if (event.key === 'Enter' && (attempts === maxAttempts || (attempts > 0 && document.getElementById('playAgainButton').style.display !== 'none'))) {
                        playAgain();
                    }
                });
            })
            .catch(error => {
                console.error('Error loading words.txt:', error);
                message = document.getElementById('message');
                message.textContent = 'Error loading word list. Please try again later.';
            });

        function createGrid() {
            if (!grid) {
                console.error('Grid element not found');
                return;
            }
            grid.innerHTML = ''; // Clear previous grid
            for (let i = 0; i < maxAttempts * 5; i++) {
                const tile = document.createElement('div');
                tile.className = 'tile';
                grid.appendChild(tile);
            }
        }

        function createKeyboard() {
            const keyboardLayout = [
                ['Q', 'W', 'E', 'R', 'T', 'Y', 'U', 'I', 'O', 'P'],
                ['A', 'S', 'D', 'F', 'G', 'H', 'J', 'K', 'L'],
                ['Z', 'X', 'C', 'V', 'B', 'N', 'M']
            ];
            const keyboardDiv = document.getElementById('keyboard');
            keyboardLayout.forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'keyboard-row';
                row.forEach(key => {
                    const keyDiv = document.createElement('div');
                    keyDiv.className = 'key';
                    keyDiv.textContent = key;
                    keyboard[key] = { element: keyDiv, state: 'unset' }; // Track state
                    rowDiv.appendChild(keyDiv);
                });
                keyboardDiv.appendChild(rowDiv);
            });
        }

        function updateKeyboard(guess, feedback) {
            guess.split('').forEach((letter, i) => {
                const state = feedback[i].includes('ðŸŸ©') ? 'green' : feedback[i].includes('ðŸŸ¨') ? 'yellow' : 'gray';
                if (keyboard[letter.toUpperCase()].state === 'unset' || (state === 'green' && keyboard[letter.toUpperCase()].state !== 'green')) {
                    keyboard[letter.toUpperCase()].element.className = `key ${state}`;
                    keyboard[letter.toUpperCase()].state = state;
                }
            });
        }

        function makeGuess() {
            if (words.length === 0 || !secret) {
                message.textContent = 'Game not initialized. Please refresh.';
                return;
            }
            const input = document.getElementById('guessInput').value.toUpperCase();
            if (input.length !== 5 || !words.includes(input)) {
                message.textContent = 'Invalid 5-letter word!';
                return;
            }
            const tiles = grid.children;
            const start = attempts * 5;
            const feedback = [];
            const secretList = secret.split('');
            for (let i = 0; i < 5; i++) {
                const tile = tiles[start + i];
                if (input[i] === secretList[i]) {
                    feedback.push(`ðŸŸ© ${input[i]}`);
                    tile.className = 'tile green';
                    secretList[i] = null;
                } else if (secretList.includes(input[i])) {
                    feedback.push(`ðŸŸ¨ ${input[i]}`);
                    tile.className = 'tile yellow';
                    secretList[secretList.indexOf(input[i])] = null;
                } else {
                    feedback.push(`â¬› ${input[i]}`);
                    tile.className = 'tile gray';
                }
                tile.textContent = input[i];
            }
            updateKeyboard(input, feedback);
            attempts++;
            if (input === secret) {
                message.textContent = `You win! Word was ${secret}. Attempts: ${attempts}`;
                score++; // Increment score on win
                document.getElementById('score').textContent = `Score: ${score}`;
                document.getElementById('playAgainButton').style.display = 'block';
            } else if (attempts === maxAttempts) {
                message.textContent = `Game over! Word was ${secret}`;
                score = 0; // Reset score on loss
                document.getElementById('score').textContent = `Score: ${score}`;
                document.getElementById('playAgainButton').style.display = 'block';
            }
            document.getElementById('guessInput').value = '';
        }

        function playAgain() {
            attempts = 0;
            secret = words[Math.floor(Math.random() * words.length)];
            message.textContent = 'New game started! Guess a 5-letter word.';
            document.getElementById('playAgainButton').style.display = 'none';
            createGrid();
            // Reset keyboard states
            for (let key in keyboard) {
                keyboard[key].state = 'unset';
                keyboard[key].element.className = 'key';
            }
        }
    </script>
</body>
</html>
